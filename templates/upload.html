<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload - Visual Perspectives</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">Visual Perspectives</h1>
            <div class="nav-links">
                <a href="/">Gallery</a>
                <a href="/admin" class="btn-admin">Admin</a>
            </div>
        </div>
    </nav>

    <main class="container upload-container">
        <div class="upload-box">
            <h2>Upload Image</h2>
            {% if error %}
                <div class="error-alert">{{ error }}</div>
            {% endif %}
            <div id="errorMessage" class="error-alert" style="display: none;"></div>
            <form method="POST" enctype="multipart/form-data" class="upload-form" id="uploadForm">
                <div class="form-group">
                    <label for="title">T√≠tulo:</label>
                    <input type="text" id="title" name="title" required>
                </div>

                <div class="form-group">
                    <label for="description">Descri√ß√£o:</label>
                    <textarea id="description" name="description" rows="4"></textarea>
                </div>

                <div class="form-group">
                    <label for="file">üì∏ Selecione a imagem:</label>
                    <input type="file" id="file" name="file" accept=".jpg,.jpeg" required>
                    <small id="fileInfo">‚úÖ Apenas <strong>JPG/JPEG</strong> | M√°ximo <strong>5MB</strong></small>
                </div>

                <button type="submit" class="btn-submit">Upload</button>
                <a href="/admin" class="btn-cancel">Cancelar</a>
            </form>
        </div>
    </main>

    <footer class="footer">
        <p>Made with ‚ù§Ô∏è</p>
    </footer>

    <script>
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('file');
        const fileInfo = document.getElementById('fileInfo');
        const errorMessage = document.getElementById('errorMessage');

        fileInput.addEventListener('change', function(e) {
            const file = this.files[0];
            hideError();
            
            if (!file) {
                fileInfo.innerHTML = '‚úÖ Apenas <strong>JPG/JPEG</strong> | M√°ximo <strong>5MB</strong>';
                return;
            }

            const fileName = file.name.toLowerCase();
            const fileSize = (file.size / (1024 * 1024)).toFixed(2);

            // Mostrar informa√ß√µes do arquivo
            let info = `üìÅ ${file.name}<br>`;

            // Validar extens√£o
            if (!fileName.endsWith('.jpg') && !fileName.endsWith('.jpeg')) {
                showError(`‚ùå Erro: Apenas JPG s√£o permitidos!<br>Seu arquivo: ${file.name}`);
                fileInput.value = '';
                return;
            }

            // Validar tipo MIME
            if (file.type !== 'image/jpeg') {
                showError(`‚ùå Erro: O arquivo deve ser JPG (image/jpeg)!<br>Tipo recebido: ${file.type}`);
                fileInput.value = '';
                return;
            }

            // Validar tamanho
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                showError(`‚ùå Erro: Arquivo muito grande!<br>Tamanho: ${fileSize}MB (m√°ximo 5MB)`);
                fileInput.value = '';
                return;
            }

            // Se tudo est√° OK
            info += `‚úÖ JPG v√°lido | ${fileSize}MB`;
            fileInfo.innerHTML = info;
            fileInfo.style.color = '#27ae60';
        });

        form.addEventListener('submit', function(e) {
            const file = fileInput.files[0];
            
            if (!file) {
                e.preventDefault();
                showError('‚ö†Ô∏è Selecione um arquivo!');
                return;
            }

            // Validar extens√£o (APENAS JPG)
            const fileName = file.name.toLowerCase();
            if (!fileName.endsWith('.jpg') && !fileName.endsWith('.jpeg')) {
                e.preventDefault();
                showError('‚ùå Erro: Apenas ficheiros JPG s√£o permitidos!<br>Seu arquivo: ' + file.name);
                return;
            }

            // Validar tipo MIME
            if (file.type !== 'image/jpeg') {
                e.preventDefault();
                showError('‚ùå Erro: O arquivo deve ser JPG (image/jpeg)!');
                return;
            }

            // Validar tamanho
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                e.preventDefault();
                const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
                showError('‚ùå Erro: Arquivo muito grande!<br>Tamanho: ' + sizeMB + 'MB (m√°ximo 5MB)');
                return;
            }

            // Validar t√≠tulo
            const title = document.getElementById('title').value.trim();
            if (!title) {
                e.preventDefault();
                showError('‚ùå Erro: O t√≠tulo √© obrigat√≥rio!');
                return;
            }

            // Se passou todas as valida√ß√µes
            console.log('‚úÖ Valida√ß√µes OK: Enviando arquivo JPG v√°lido');
            hideError();
        });

        function showError(message) {
            errorMessage.innerHTML = message;
            errorMessage.style.display = 'block';
            errorMessage.style.color = '#721c24';
            errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }
    </script>
</body>
</html>


